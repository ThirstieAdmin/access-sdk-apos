{# modules/product-line/views/show.html #}
{% extends "layout.html" %}

{% import 'macros.html' as macros %}
{% import 'recipe-fragment.html' as recipeFragment %}

{% set item = data.piece %}
{% set altText = item.title %}

{% if item.primaryImage.items | length %}
  {% set attachment = apos.image.first(item.primaryImage or {}) %}
  {% set imageUrl = apos.attachment.url(attachment, { size: 'full' }) %}
  {% set altText = attachment.title %}
{% else %}
  {% set imageUrl = item.imageSpec | replace("{dims}.", ",x600f.") %}
{% endif %}


{% block main %}
<section class="th-pdp-content flex flex-row md:flex-col items-start md:items-center justify-center">
  <div class="th-pdp-left">
    <div class="th-pdp-left-content flex items-center">
      {% if data.page.showPDPImageAs == 'carousel' %}
      <swiper-container
        class="th-pdp-swiper__container"
        thumbs-swiper="#th-pdp-thumbs"
        space-between="10"
        navigation="true"
        pagination="true"
        loop="false"
        style="--swiper-navigation-color: #0f0f0f; --swiper-pagination-color: #0f0f0f;--swiper-navigation-size: 28px;"
      >
        <swiper-slide>
          <div class="th-pdp-img-container">
            <img
            src="{{ imageUrl }}" 
            alt="{{ altText }}"
            />
          </div>
        </swiper-slide>
        {% for productImage in item._images %}
          {% set imgAttachment = apos.image.first(productImage or {}) %}
          {% set altImageUrl = apos.attachment.url(imgAttachment, { size: 'full' }) %}
          {% set altImageAltText = imgAttachment.title or "product image" %}
          <swiper-slide>
            <div class="th-pdp-img-container">
              <img
              class="th-pdp-left__primary_img md:w-screen"
              src="{{ altImageUrl }}" 
              alt="{{altImageAltText}}"
            /></div>
          </swiper-slide>
        {% endfor %}
      </swiper-container>
      {% if item._images | length %}
      <swiper-container
        id="th-pdp-thumbs"
        class="th-pdp-thumbs"
        space-between="10"
        slides-per-view="5"
        free-mode="true"
        watch-slides-progress="true"
      >
        <swiper-slide class="th-pdp-thumb__slide">
          <img 
          class="th-pdp-thumb__img"
          src="{{ imageUrl }}" 
          alt="{{ altText }}"
        /></swiper-slide>
        {% for productImage in item._images %}
          {% set imgAttachment = apos.image.first(productImage or {}) %}
          {% set altImageUrl = apos.attachment.url(imgAttachment, { size: 'full' }) %}
          {% set altImageAltText = imgAttachment.title or "product image" %}
          <swiper-slide class="th-pdp-thumb__slide"><img
            class="th-pdp-thumb__img"
            src="{{ altImageUrl }}" 
            alt="{{altImageAltText}}"
          /></swiper-slide>
        {% endfor %}
      </swiper-container>
      {% endif %}
      {% else %}
      <img
        class="th-pdp-left__primary_img md:w-screen mx-auto"
        src="{{ imageUrl }}" 
        alt="{{ altText }}"
      />
      {% endif %}
    </div>
  </div>
  <div class="th-pdp-right">
    <th-pdp-commerce product-line-id="{{ item.thirstiePLID }}" hide-product-name>
      <div slot="additional-content">
        <h1 class="th-pdp-right__title">{{ item.title }}</h1>
        {% if data.global.locationType === 'address' %}
          {{ macros.renderAddressAvailability() }}
        {% endif %}
      </div>
    </th-pdp-commerce>
  </div>
</section>

{% if data.page.showRelatedProductsPDP and item._productlines | length %}
<h3>Related products</h3>
<div class="flex flex-row md:flex-col items-center justify-center gap-4 m-0 p-8">
  {% for productLine in item._productlines %}
    <th-product-add-to-cart product-line-id="{{ productLine.thirstiePLID }}" pdp-link="{{ productLine._url }}" link-text="Learn more" show-link no-collection></th-product-add-to-cart>
  {% endfor %}
</div>
{% endif %}

{% if data.page.showRecipesPDP and item._recipes | length %}
<div class="relative">
  <h3>Featured Cocktails</h3>
  <swiper-container
    class="th-pdp-recipe-swiper"
    navigation="true"
    pagination="false"
    loop="true"
    style="--swiper-navigation-color: #4f4f4f; --swiper-navigation-size: 1.5rem;"
  >
  {% for recipe in item._recipes %}
    <swiper-slide>
      <div class="th-pdp-recipe-card">
        {% render recipeFragment.recipeCardWide(recipe) %}
      </div>
    </swiper-slide>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
