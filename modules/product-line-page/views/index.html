{% extends "layout.html" %}

{% import 'breadcrumb-fragment.html' as breadcrumbFragment %}

{% import '@apostrophecms/pager:macros.html' as pager with context %}
{% import 'macros.html' as macros %}

{% block main %}

{% if data.page.showProductCardImageAs in ("no-image", "carousel") %}
  {% set showImage = "no-image" %}
{% else %}
  {% set showImage = "" %}
{% endif %}

{% set plpTitle = data.page.titleOverride or data.page.title %}

  {% if data.global.locationType === 'address' %}
    {{ macros.renderAddressAvailability() }}
  {% endif %}

  {% render breadcrumbFragment.breadcrumb() %}

  <h1 class="text-xl leading-loose mt-8">{{ plpTitle }}</h1>
  <th-catalog-collection>
    <div class="my-4 mx-0 px-4 md:p-0 gap-0 w-full">

      <div class="grid grid-cols-3 md:grid-cols-1 items-center justify-center">
        {% for productLine in data.pieces %}
          <div class="my-4 mx-auto">
            {% if data.page.showProductCardImageAs == 'carousel' %}
              {% if productLine.primaryImage.items | length %}
                {% set attachment = apos.image.first(productLine.primaryImage or {}) %}
                {% set imageUrl = apos.attachment.url(attachment, { size: 'full' }) %}
                {% set altText = attachment.title %}
              {% else %}
                {% set imageUrl = productLine.imageSpec | replace("{dims}.", ".") %}
              {% endif %}
              <swiper-container
                class="th-plp-swiper__container"
                space-between="10"
                navigation="true"
                pagination="false"
                loop="true"
                style="--swiper-navigation-color: #4f4f4f; --swiper-navigation-size: 1.5rem;"
              >
                <swiper-slide>
                  <img
                  class="th-plp__primary_img"
                  src="{{ imageUrl }}"
                  alt="{{ altText }}"
                /></swiper-slide>
                {% for productImage in productLine._images %}
                  {% set imgAttachment = apos.image.first(productImage or {}) %}
                  {% set altImageUrl = apos.attachment.url(imgAttachment, { size: 'full' }) %}
                  {% set altImageAltText = imgAttachment.title or "product image" %}
                  <swiper-slide>
                    <img
                    class="th-plp__primary_img"
                    src="{{ altImageUrl }}" 
                    alt="{{altImageAltText}}"
                  /></swiper-slide>
                {% endfor %}
              </swiper-container>
            {% endif %}
            <th-product-add-to-cart product-line-id="{{ productLine.thirstiePLID }}" pdp-link="{{ productLine._url }}" cta-label="{{ data.page.ctaLabel }}"  show-link link-text="{{ data.page.linkText }}" {{ showImage }}></th-product-add-to-cart>
          </div>
        {% endfor %}
      </div>
      {{ pager.render({
        page: data.currentPage,
        total: data.totalPages,
        class: 'product-pager'
      }, data.url
      ) }}
    </div>
  </th-catalog-collection>
{% endblock %}