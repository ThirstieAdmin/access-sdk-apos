{% extends "layout.html" %}
{% import '@apostrophecms/pager:macros.html' as pager with context %}

{% block main %}

  <h2>{{ data.page.title }}</h2>
  {% if data.global.locationType === 'address' %}
  <style>
    .th-availability-container {
      background-color: var(--th-availability-bg, transparent);
      padding:2rem 0 1rem;
    }
    .th-availability__form {
      border: 1px solid var(--th-availability-border);
      padding:2rem 2rem .5rem;
      margin:0 auto;
      width: 600px;
    }
    .th-availability__form__title {
      background-color: var(--th-availability-bg, transparent);
      color: var(--th-availability-text-color);
      position: relative;
      top: -42px;
      margin: 0 auto -32px;
      padding: 0 1rem;
      text-align: center;
      width: fit-content;
      line-height: 120%;
    }
  </style>
  <section class="th-availability-container box-border">
    <div class="th-availability__form box-border th-fouc-block">
      <div class="th-availability__form__title box-border">Available in your area?</div>
      <th-address-check text-color="var(--th-availability-text-color)" />
    </div>
  </section>
  {% endif %}
  <div class="my-4 mx-0 px-4 md:p-0 gap-4 w-full">
    <div class="grid grid-cols-3 md:grid-cols-1 items-center justify-center">
      {% for recipe in data.pieces %}
        {% set attachment = apos.image.first(recipe.primaryImage or {}) %}
        {% set imageUrl = apos.attachment.url(attachment, { size: 'full' }) %}
        {% set altText = attachment.title %}
        {% if recipe._productlines | length %}
          {% set product = recipe._productlines[0] %}
          {% set productType = product.productType %}
        {% else %}
          {% set product = {"title": "n/a"} %}
          {% set productType = "" %}
        {% endif %}
        <div class="my-4 mx-auto">
          <figure>
            <a href="{{ recipe._url }}">
              <img
                class="th-recipe-card__primary_img"
                src="{{ imageUrl }}" 
                alt="{{altText}}"
              />
            </a>
            <figcaption class="th-recipe-card__title">{{ recipe.title }}</figcaption>
            <figcaption class="th-recipe-card__subtitle">{{ productType }}</figcaption>
          </figure>
        </div>
      {% endfor %}
    </div>
    {{ pager.render({
      page: data.currentPage,
      total: data.totalPages,
      class: 'recipe-pager'
    }, data.url
    ) }}
  </div>
{% endblock %}