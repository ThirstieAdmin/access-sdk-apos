{% fragment ageGateModal() %}

{% set ageGateType = data.global.ageGateType or 'dob' %}

{% if ageGateType !== 'disabled' %}
  {% set ageGateHeaderText = data.global.ageGateHeaderText %}

  {% if data.global.ageGateLogo.items | length %}
    {% set ageGateLogo = apos.image.first(data.global.ageGateLogo) %}
  {% endif %}

  {% if data.global.ageGateBackgroundImage.items | length %}
    {% set ageGatebackgroundColor = apos.modules['theme-widget'].convertPreset(data.global.ageGateBackgroundColor) or 'rgba(50,50,50,0.5)' %}
    {% set agegateBackgroundImg = apos.image.first(data.global.ageGateBackgroundImage) %}
    {% set agegateBackgroundImgUrl = apos.attachment.url(agegateBackgroundImg, { size: 'full' }) %}
    {% set ageGatebackground = "linear-gradient(to bottom, " + ageGatebackgroundColor +" 0%, " + ageGatebackgroundColor + " 100%), url(" + agegateBackgroundImgUrl + ") no-repeat center/cover" %}
  {% else %}
    {% set ageGatebackground = apos.modules['theme-widget'].convertPreset(data.global.ageGateBackgroundColor) or data.global.primaryColor or '#000' %}
  {% endif %}

  {% set ageGateLogoHeight = data.global.ageGateLogoHeight or '125px' %}

  {% if not data.user %}
    {# only show age gate if user is not logged in #}
    <th-conditional-modal query="ageGatePassed">
      <div class="th-fouc-block p-0 m-0 w-screen h-screen flex flex-col items-center justify-center box-border th-ag-container" style="background:{{ageGatebackground}};color:var(--th-ag-textcolor, --th-c-white);" >
        <div style="background-color: var(--th-ag-form-bg, transparent);" class="flex flex-col items-center justify-center w-full p-4 box-border th-ag-form-content">
          {% if ageGateLogo %}
            <div class="m-0 py-4">
              <img class="m-0" src="{{ apos.attachment.url(ageGateLogo, { size: 'full' }) }}" alt="{{ ageGateLogo.alt or 'Age Gate Logo' }}" style="max-height:{{ageGateLogoHeight}}"/>
            </div>
          {% endif %}
          <div class="my-4 flex flex-col items-center justify-center text-center">
            <div class="my-2">{{ ageGateHeaderText }}</div>
            <div class="my-2">
              {% if data.global.ageGateSubHeaderContent.items[0].type === "@apostrophecms/rich-text" %}
                {{ apos.area.richText(data.global.ageGateSubHeaderContent) }}
              {% elif data.global.ageGateSubHeaderContent.items[0].type === "@apostrophecms/html" %}
                {{ data.global.ageGateSubHeaderContent.items[0].code | safe}}
              {% endif %}
            </div>
          </div>
          <th-age-verification class="w-full" type="{{ ageGateType }}" confirm-text="Enter"></th-age-verification>
          <th-conditional-label query="ageGatePassed" alt-label="All sales of alcohol are fulfilled by licensed retailers on the Thirstie Network." class="my-4">
            {% if data.global.ageGateFailContent.items[0].type === "@apostrophecms/rich-text" %}
              {{ apos.area.richText(data.global.ageGateFailContent) }}
            {% elif data.global.ageGateFailContent.items[0].type === "@apostrophecms/html" %}
              {{ data.global.ageGateFailContent.items[0].code | safe}}
            {% else %}
              <span>You must be 21 or older to enter. Click <a href="https://responsibility.org" target="_blank" class="font-bold">here</a></span>
            {% endif %}
          </th-conditional-label>
          {% if not data.global.ageGateHideThirstieDisclaimer %}
            <div style="color:var(--th-ag-textcolor, --th-c-white);">
              <th-disclaimer text-color="var(--th-ag-textcolor, --th-c-white)" text-align="center" />
            </div>
          {% endif %}
        </div>
      </div>
    </th-conditional-modal>

  {% endif %}

{% endif %}

{% endfragment %}
